---
title: "LierneGreening"
author: "Markus Fjellstad Israelsen"
date: "9 2 2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

To do list:
  1. Remove all the images that are not during the day. We could probably only include images taken between 11:00 -     15:00 to make sure we only use images with enough light and it takes a "long" time for a change in "greenness" to     occur. 

```{r}

library(EBImage)
library(countcolors)

```

Load test images
```{r, echo = TRUE, eval = TRUE}

imagePath = "C:/Users/markus.israelsen/OneDrive - NINA/GitHub/LierneGreening/TestImages/"
images = list.files(imagePath)
colordistance::plotPixels(paste0(imagePath, images[2000]))

```

Counting the pixels using a spherical range. Pick a mid green color and include all colors in a radius from that color. 
```{r, echo = TRUE, eval = TRUE}

i1.spherical = countcolors::sphericalRange(i1, center = c(0.38, 0.55, 0.17), radius = 0.10, color.pixels = FALSE, plotting = FALSE)

i2.spherical = countcolors::sphericalRange(i2, center = c(0.38, 0.55, 0.17), radius = 0.10, color.pixels = FALSE, plotting = FALSE)

i3.spherical = countcolors::sphericalRange(i3, center = c(0.38, 0.55, 0.17), radius = 0.10, color.pixels = FALSE, plotting = FALSE)

i4.spherical = countcolors::sphericalRange(i4, center = c(0.38, 0.55, 0.17), radius = 0.10, color.pixels = FALSE, plotting = FALSE)

i5.spherical = countcolors::sphericalRange(i5, center = c(0.38, 0.55, 0.17), radius = 0.10, color.pixels = FALSE, plotting = FALSE)

i6.spherical = countcolors::sphericalRange(i6, center = c(0.38, 0.55, 0.17), radius = 0.10, color.pixels = FALSE, plotting = FALSE)

i7.spherical = countcolors::sphericalRange(i7, center = c(0.38, 0.55, 0.17), radius = 0.10, color.pixels = FALSE, plotting = FALSE)


# Check if we have to increase/decrease the radius
#countcolors::changePixelColor(i7, i7.spherical$pixel.idx, target.color = "magenta")

# Should change the radius to 12%
countcolors::sphericalRange(i7, center = c(0.38, 0.55, 0.17), radius = 12, color.pixels = FALSE, plotting = TRUE, target.color = "magenta")

# Change the radius to 12%
i1.sph = countcolors::sphericalRange(i1, center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)

i2.sph = countcolors::sphericalRange(i2, center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)

i3.sph = countcolors::sphericalRange(i3, center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)

i4.sph = countcolors::sphericalRange(i4, center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)

i5.sph = countcolors::sphericalRange(i5, center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)

i6.sph = countcolors::sphericalRange(i6, center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)

i7.sph = countcolors::sphericalRange(i7, center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)

# Extract the percentage covarage of green
i1.sph$img.fraction * 100
i2.sph$img.fraction * 100
i3.sph$img.fraction * 100
i4.sph$img.fraction * 100
i5.sph$img.fraction * 100
i6.sph$img.fraction * 100
i7.sph$img.fraction * 100

```

Create the function to run through all the images
```{r, echo = TRUE, eval = FALSE}

RL0017Path2020 = "C:/Users/markus.israelsen/OneDrive - NINA/GitHub/LierneGreening/TestImages/"
images = list.files(RL0017Path2020)

greenFraction = c()
for(i in 1698:length(images)){
  imgGreenFraction = countcolors::sphericalRange(jpeg::readJPEG(paste0(RL0017Path2020, images[i])), center = c(0.38, 0.55, 0.17), radius = 0.12, color.pixels = FALSE, plotting = FALSE)
  igf = imgGreenFraction$img.fraction * 100
  greenFraction = append(greenFraction, igf)
}

```

Using rectangular ranges instead of spherical ranges. Set a range of RGB values that will be included (seems to work really well)
```{r, echo = TRUE, eval = FALSE}

# Display an image, showing all the green pixels with a magenta color (Have to crop the bottom so that the Reconyx logo is not included)
countcolors::rectangularRange(jpeg::readJPEG(paste0(RL0017Path2020, images[2198])), upper = c(0.60, 1, 0.4), lower = c(0, 0.4, 0), target.color = "magenta")

# For loop that extracts the fraction of green in each image
recGreenFraction = c()
for(i in 1898:length(images)){
  recImgGreenFraction = countcolors::rectangularRange(jpeg::readJPEG(paste0(RL0017Path2020, images[i])), upper = c(0.60, 1, 0.4), lower = c(0, 0.4, 0), color.pixels = FALSE, plotting = FALSE)
  recIGF = recImgGreenFraction$img.fraction * 100
  recGreenFraction = append(recGreenFraction, recIGF)
}

plot(1:401, recGreenFraction, type = "l")

```







































